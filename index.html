<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>RauchFrei Duo - Gemeinsam zum Ziel</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-900);
            line-height: 1.6;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .user-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .user-btn {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--gray-200);
            background: white;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .user-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat-card {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
        }
        
        .cigarette-tracker {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .cigarette-btn {
            aspect-ratio: 1;
            border: 2px solid var(--gray-300);
            background: white;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
        }
        
        .cigarette-btn.smoked {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }
        
        .cigarette-btn.emergency {
            border-color: var(--warning);
            background: var(--warning);
            color: white;
        }
        
        .cigarette-time {
            position: absolute;
            bottom: 0.25rem;
            font-size: 0.625rem;
            color: var(--gray-600);
        }
        
        .cigarette-btn.smoked .cigarette-time {
            color: white;
        }
        
        .progress-bar {
            height: 2rem;
            background: var(--gray-200);
            border-radius: 1rem;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--primary));
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .withdrawal-tracker {
            margin: 1rem 0;
        }
        
        .withdrawal-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .withdrawal-label {
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .withdrawal-scale {
            display: flex;
            gap: 0.25rem;
        }
        
        .scale-btn {
            width: 2rem;
            height: 2rem;
            border: 1px solid var(--gray-300);
            background: white;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }
        
        .scale-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .trigger-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .trigger-tag {
            padding: 0.5rem 1rem;
            background: var(--gray-100);
            border-radius: 2rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .trigger-tag.active {
            background: var(--primary);
            color: white;
        }
        
        .achievement-card {
            background: linear-gradient(135deg, var(--success), #10b981dd);
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .achievement-icon {
            font-size: 2rem;
        }
        
        .achievement-content h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .achievement-content p {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .partner-sync {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: 0.75rem;
            margin: 1rem 0;
        }
        
        .partner-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .status-indicator {
            width: 0.75rem;
            height: 0.75rem;
            background: var(--success);
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
        
        .btn {
            width: 100%;
            padding: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }
        
        .btn-secondary:hover {
            background: var(--gray-300);
        }
        
        .coach-message {
            background: linear-gradient(135deg, #667eea22, #764ba222);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }
        
        .coach-message h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .coach-message p {
            color: var(--gray-700);
            line-height: 1.6;
        }
        
        .tab-navigation {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
            background: white;
            padding: 0.5rem;
            border-radius: 0.75rem;
        }
        
        .tab-btn {
            padding: 0.75rem 0.5rem;
            background: transparent;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .tab-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .hidden {
            display: none !important;
        }
        
        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border-radius: 2rem;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .crisis-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 3.5rem;
            height: 3.5rem;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            transition: all 0.2s;
            z-index: 1000;
        }
        
        .crisis-btn:hover {
            transform: scale(1.1);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 2000;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            margin-bottom: 1rem;
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--gray-900);
        }
        
        .breathing-exercise {
            text-align: center;
            padding: 2rem;
        }
        
        .breath-circle {
            width: 150px;
            height: 150px;
            border: 4px solid var(--primary);
            border-radius: 50%;
            margin: 0 auto 1rem;
            animation: breathe 4s ease-in-out infinite;
        }
        
        @keyframes breathe {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }
        
        .breath-text {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div id="app"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;
        
        const SmokingCessationApp = () => {
            // Core State
            const [currentUser, setCurrentUser] = useState('A');
            const [activeTab, setActiveTab] = useState('today');
            const [showCrisisModal, setShowCrisisModal] = useState(false);
            
            // User Data State
            const [userData, setUserData] = useState(() => {
                const saved = localStorage.getItem('smokingData');
                if (saved) return JSON.parse(saved);
                
                return {
                    A: {
                        name: 'Partner A',
                        dailyLimit: 6,
                        emergencyUsed: false,
                        cigarettesToday: [],
                        withdrawalSymptoms: {
                            reizbarkeit: 0,
                            hunger: 0,
                            konzentration: 0,
                            muedigkeit: 0
                        },
                        triggers: [],
                        level: 'Starter',
                        points: 0,
                        streakDays: 0,
                        totalDaysClean: 0,
                        startDate: new Date().toISOString(),
                        history: []
                    },
                    B: {
                        name: 'Partner B',
                        dailyLimit: 6,
                        emergencyUsed: false,
                        cigarettesToday: [],
                        withdrawalSymptoms: {
                            reizbarkeit: 0,
                            hunger: 0,
                            konzentration: 0,
                            muedigkeit: 0
                        },
                        triggers: [],
                        level: 'Starter',
                        points: 0,
                        streakDays: 0,
                        totalDaysClean: 0,
                        startDate: new Date().toISOString(),
                        history: []
                    },
                    shared: {
                        lastSync: new Date().toISOString(),
                        achievements: [],
                        weeklyReductionRate: 1,
                        flexibilityUsedThisWeek: false
                    }
                };
            });
            
            // Save to localStorage on change
            useEffect(() => {
                localStorage.setItem('smokingData', JSON.stringify(userData));
            }, [userData]);
            
            // Reset daily data at midnight
            useEffect(() => {
                const checkNewDay = () => {
                    const lastCheck = localStorage.getItem('lastDayCheck');
                    const today = new Date().toDateString();
                    
                    if (lastCheck !== today) {
                        localStorage.setItem('lastDayCheck', today);
                        resetDailyData();
                    }
                };
                
                checkNewDay();
                const interval = setInterval(checkNewDay, 60000); // Check every minute
                return () => clearInterval(interval);
            }, []);
            
            const resetDailyData = () => {
                setUserData(prev => ({
                    ...prev,
                    A: {
                        ...prev.A,
                        cigarettesToday: [],
                        emergencyUsed: false,
                        withdrawalSymptoms: {
                            reizbarkeit: 0,
                            hunger: 0,
                            konzentration: 0,
                            muedigkeit: 0
                        },
                        triggers: []
                    },
                    B: {
                        ...prev.B,
                        cigarettesToday: [],
                        emergencyUsed: false,
                        withdrawalSymptoms: {
                            reizbarkeit: 0,
                            hunger: 0,
                            konzentration: 0,
                            muedigkeit: 0
                        },
                        triggers: []
                    }
                }));
            };
            
            const recordCigarette = (index, isEmergency = false) => {
                const now = new Date();
                setUserData(prev => {
                    const user = prev[currentUser];
                    const newCigarettes = [...user.cigarettesToday];
                    
                    if (isEmergency && !user.emergencyUsed) {
                        newCigarettes.push({
                            time: now.toISOString(),
                            isEmergency: true
                        });
                        
                        return {
                            ...prev,
                            [currentUser]: {
                                ...user,
                                cigarettesToday: newCigarettes,
                                emergencyUsed: true
                            }
                        };
                    } else if (index < user.dailyLimit && !newCigarettes[index]) {
                        newCigarettes[index] = {
                            time: now.toISOString(),
                            isEmergency: false
                        };
                        
                        // Points for optimal distribution
                        const hoursSinceLastCig = newCigarettes.length > 1 ? 
                            (now - new Date(newCigarettes[index - 1]?.time)) / 3600000 : 0;
                        
                        let points = 10;
                        if (hoursSinceLastCig >= 2) points += 5; // Good spacing
                        
                        return {
                            ...prev,
                            [currentUser]: {
                                ...user,
                                cigarettesToday: newCigarettes,
                                points: user.points + points
                            }
                        };
                    }
                    
                    return prev;
                });
            };
            
            const updateWithdrawal = (symptom, value) => {
                setUserData(prev => ({
                    ...prev,
                    [currentUser]: {
                        ...prev[currentUser],
                        withdrawalSymptoms: {
                            ...prev[currentUser].withdrawalSymptoms,
                            [symptom]: value
                        }
                    }
                }));
            };
            
            const toggleTrigger = (trigger) => {
                setUserData(prev => {
                    const user = prev[currentUser];
                    const triggers = user.triggers.includes(trigger)
                        ? user.triggers.filter(t => t !== trigger)
                        : [...user.triggers, trigger];
                    
                    return {
                        ...prev,
                        [currentUser]: {
                            ...user,
                            triggers
                        }
                    };
                });
            };
            
            const getCoachingMessage = () => {
                const user = userData[currentUser];
                const cigarettesSmoked = user.cigarettesToday.filter(c => c).length;
                const timeNow = new Date().getHours();
                
                if (cigarettesSmoked === 0 && timeNow > 12) {
                    return {
                        title: "Starke Leistung!",
                        message: "Du hast heute noch keine Zigarette geraucht. Dein Körper regeneriert sich bereits merklich. Die Sauerstoffversorgung verbessert sich stündlich."
                    };
                } else if (cigarettesSmoked > user.dailyLimit * 0.7 && timeNow < 15) {
                    return {
                        title: "Strategische Anpassung empfohlen",
                        message: "Du hast bereits " + cigarettesSmoked + " von " + user.dailyLimit + " Zigaretten konsumiert. Plane die verbleibenden bewusst für potenzielle Stress-Situationen ein."
                    };
                } else if (user.withdrawalSymptoms.reizbarkeit > 7) {
                    return {
                        title: "Entzugsmanagement",
                        message: "Hohe Reizbarkeit erkannt. Das ist eine normale neurologische Anpassung. Nutze die Atemübung oder einen kurzen Spaziergang zur Dopamin-Regulation."
                    };
                } else {
                    return {
                        title: "Fortschritt messbar",
                        message: "Du kontrollierst deinen Konsum bewusst. Jede Stunde ohne Zigarette verbessert deine Lungenfunktion um ca. 2%. Weiter so!"
                    };
                }
            };
            
            const calculateProgress = () => {
                const user = userData[currentUser];
                const cigarettesSmoked = user.cigarettesToday.filter(c => c).length;
                return Math.max(0, ((user.dailyLimit - cigarettesSmoked) / user.dailyLimit) * 100);
            };
            
            const getLevelInfo = (points) => {
                if (points < 100) return { level: 'Starter', icon: '🌱' };
                if (points < 500) return { level: 'Fortgeschritten', icon: '🌿' };
                if (points < 1000) return { level: 'Experte', icon: '🌳' };
                return { level: 'Meister', icon: '🏆' };
            };
            
            const formatTime = (isoString) => {
                if (!isoString) return '';
                const date = new Date(isoString);
                return date.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
            };
            
            // Render Functions
            const renderTodayTab = () => {
                const user = userData[currentUser];
                const cigarettesSmoked = user.cigarettesToday.filter(c => c).length;
                const coaching = getCoachingMessage();
                
                return (
                    <>
                        <div className="card">
                            <h3 style={{ marginBottom: '1rem', color: 'var(--gray-800)' }}>
                                Heutiges Kontingent
                            </h3>
                            
                            <div className="stats-grid">
                                <div className="stat-card">
                                    <div className="stat-value">{cigarettesSmoked}/{user.dailyLimit}</div>
                                    <div className="stat-label">Geraucht</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">{user.dailyLimit - cigarettesSmoked}</div>
                                    <div className="stat-label">Verbleibend</div>
                                </div>
                            </div>
                            
                            <div className="progress-bar">
                                <div 
                                    className="progress-fill" 
                                    style={{ width: `${calculateProgress()}%` }}
                                >
                                    {calculateProgress().toFixed(0)}% kontrolliert
                                </div>
                            </div>
                            
                            <div className="cigarette-tracker">
                                {[...Array(user.dailyLimit)].map((_, i) => (
                                    <button
                                        key={i}
                                        className={`cigarette-btn ${user.cigarettesToday[i] ? 'smoked' : ''}`}
                                        onClick={() => recordCigarette(i)}
                                    >
                                        {user.cigarettesToday[i] ? '🚬' : `${i + 1}`}
                                        {user.cigarettesToday[i] && (
                                            <span className="cigarette-time">
                                                {formatTime(user.cigarettesToday[i].time)}
                                            </span>
                                        )}
                                    </button>
                                ))}
                                {!user.emergencyUsed && (
                                    <button
                                        className="cigarette-btn emergency"
                                        onClick={() => recordCigarette(user.dailyLimit, true)}
                                    >
                                        🆘
                                    </button>
                                )}
                            </div>
                        </div>
                        
                        <div className="card">
                            <div className="coach-message">
                                <h4>{coaching.title}</h4>
                                <p>{coaching.message}</p>
                            </div>
                        </div>
                    </>
                );
            };
            
            const renderWithdrawalTab = () => {
                const user = userData[currentUser];
                const symptoms = [
                    { key: 'reizbarkeit', label: 'Reizbarkeit' },
                    { key: 'hunger', label: 'Hunger/Appetit' },
                    { key: 'konzentration', label: 'Konzentration' },
                    { key: 'muedigkeit', label: 'Müdigkeit' }
                ];
                
                const triggers = [
                    'Arbeitsstress', 'Kaffeepause', 'Nach dem Essen',
                    'Soziale Situation', 'Alkohol', 'Langeweile',
                    'Streit', 'Autofahren', 'Telefongespräch'
                ];
                
                return (
                    <div className="card">
                        <h3 style={{ marginBottom: '1rem', color: 'var(--gray-800)' }}>
                            Entzugs-Tracking
                        </h3>
                        
                        <div className="withdrawal-tracker">
                            {symptoms.map(symptom => (
                                <div key={symptom.key} className="withdrawal-item">
                                    <span className="withdrawal-label">{symptom.label}</span>
                                    <div className="withdrawal-scale">
                                        {[...Array(10)].map((_, i) => (
                                            <button
                                                key={i}
                                                className={`scale-btn ${user.withdrawalSymptoms[symptom.key] === i + 1 ? 'selected' : ''}`}
                                                onClick={() => updateWithdrawal(symptom.key, i + 1)}
                                            >
                                                {i + 1}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <h4 style={{ marginTop: '1.5rem', marginBottom: '0.5rem', color: 'var(--gray-800)' }}>
                            Heutige Trigger
                        </h4>
                        
                        <div className="trigger-list">
                            {triggers.map(trigger => (
                                <button
                                    key={trigger}
                                    className={`trigger-tag ${user.triggers.includes(trigger) ? 'active' : ''}`}
                                    onClick={() => toggleTrigger(trigger)}
                                >
                                    {trigger}
                                </button>
                            ))}
                        </div>
                        
                        {user.withdrawalSymptoms.reizbarkeit > 5 && (
                            <div className="coach-message" style={{ marginTop: '1rem' }}>
                                <h4>Bewältigungsstrategie</h4>
                                <p>
                                    Erhöhte Reizbarkeit ist ein Zeichen aktiver Neuroadaptation. 
                                    Dein Dopamin-System stellt sich um. Nutze progressive Muskelentspannung 
                                    oder die 4-7-8 Atemtechnik zur Regulation.
                                </p>
                            </div>
                        )}
                    </div>
                );
            };
            
            const renderProgressTab = () => {
                const user = userData[currentUser];
                const partner = userData[currentUser === 'A' ? 'B' : 'A'];
                const levelInfo = getLevelInfo(user.points);
                
                const daysSinceStart = Math.floor(
                    (new Date() - new Date(user.startDate)) / (1000 * 60 * 60 * 24)
                );
                
                return (
                    <>
                        <div className="card">
                            <h3 style={{ marginBottom: '1rem', color: 'var(--gray-800)' }}>
                                Dein Fortschritt
                            </h3>
                            
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '1rem' }}>
                                <div className="level-badge">
                                    <span>{levelInfo.icon}</span>
                                    <span>{levelInfo.level}</span>
                                </div>
                                <div style={{ textAlign: 'right' }}>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--primary)' }}>
                                        {user.points} Punkte
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: 'var(--gray-600)' }}>
                                        Tag {daysSinceStart + 1}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="stats-grid">
                                <div className="stat-card">
                                    <div className="stat-value">{user.streakDays}</div>
                                    <div className="stat-label">Tage in Folge</div>
                                </div>
                                <div className="stat-card">
                                    <div className="stat-value">{user.dailyLimit}</div>
                                    <div className="stat-label">Tägliches Limit</div>
                                </div>
                            </div>
                            
                            <div className="partner-sync">
                                <div className="partner-status">
                                    <span>
                                        <span className="status-indicator"></span>
                                        Partner {currentUser === 'A' ? 'B' : 'A'}
                                    </span>
                                    <span style={{ fontWeight: '600' }}>
                                        {partner.cigarettesToday.filter(c => c).length}/{partner.dailyLimit} heute
                                    </span>
                                </div>
                                <p style={{ fontSize: '0.875rem', color: 'var(--gray-600)', marginTop: '0.5rem' }}>
                                    Ihr macht gemeinsam Fortschritte. Starke Teamleistung!
                                </p>
                            </div>
                        </div>
                        
                        <div className="card">
                            <h3 style={{ marginBottom: '1rem', color: 'var(--gray-800)' }}>
                                Körperliche Regeneration
                            </h3>
                            
                            <div style={{ marginBottom: '1rem' }}>
                                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '0.75rem' }}>
                                    <span style={{ fontSize: '1.5rem', marginRight: '0.75rem' }}>🫁</span>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>Lungenfunktion</div>
                                        <div style={{ fontSize: '0.875rem', color: 'var(--gray-600)' }}>
                                            +{Math.min(daysSinceStart * 2, 30)}% verbessert
                                        </div>
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '0.75rem' }}>
                                    <span style={{ fontSize: '1.5rem', marginRight: '0.75rem' }}>❤️</span>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>Herzfrequenz</div>
                                        <div style={{ fontSize: '0.875rem', color: 'var(--gray-600)' }}>
                                            Normalisiert sich zunehmend
                                        </div>
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '0.75rem' }}>
                                    <span style={{ fontSize: '1.5rem', marginRight: '0.75rem' }}>👃</span>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>Geruchssinn</div>
                                        <div style={{ fontSize: '0.875rem', color: 'var(--gray-600)' }}>
                                            {daysSinceStart > 3 ? 'Deutlich verbessert' : 'Beginnt sich zu verbessern'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </>
                );
            };
            
            const renderStrategiesTab = () => {
                const strategies = [
                    {
                        title: "4-7-8 Atemtechnik",
                        description: "4 Sekunden einatmen, 7 halten, 8 ausatmen. Aktiviert Parasympathikus.",
                        icon: "🧘"
                    },
                    {
                        title: "Kaugummi-Strategie",
                        description: "Zuckerfreier Kaugummi befriedigt orales Bedürfnis ohne Nikotin.",
                        icon: "🍬"
                    },
                    {
                        title: "5-Minuten-Regel",
                        description: "Verlangen dauert durchschnittlich 3-5 Minuten. Abwarten funktioniert.",
                        icon: "⏱️"
                    },
                    {
                        title: "Wasser-Technik",
                        description: "Ein Glas kaltes Wasser trinken. Unterbricht Sucht-Automatismus.",
                        icon: "💧"
                    },
                    {
                        title: "Bewegungs-Intervention",
                        description: "Kurzer Spaziergang oder 20 Kniebeugen. Dopamin-Alternative.",
                        icon: "🏃"
                    },
                    {
                        title: "Partner-Check-In",
                        description: "Kurznachricht an Partner. Gemeinsame Accountability nutzen.",
                        icon: "💬"
                    }
                ];
                
                const achievements = [
                    {
                        title: "Erste 24 Stunden",
                        description: "Kontingent eingehalten für einen Tag",
                        earned: true,
                        icon: "🎯"
                    },
                    {
                        title: "Arbeitswoche gemeistert",
                        description: "5 Tage Stress-Management ohne Überschreitung",
                        earned: false,
                        icon: "💼"
                    },
                    {
                        title: "Team-Erfolg",
                        description: "Beide Partner 7 Tage innerhalb Limit",
                        earned: false,
                        icon: "🤝"
                    }
                ];
                
                return (
                    <>
                        <div className="card">
                            <h3 style={{ marginBottom: '1rem', color: 'var(--gray-800)' }}>
                                Bewältigungsstrategien
                            </h3>
                            
                            {strategies.map((strategy, index) => (
                                <div key={index} style={{ 
                                    display: 'flex', 
                                    alignItems: 'flex-start', 
                                    marginBottom: '1rem',
                                    padding: '0.75rem',
                                    background: 'var(--gray-50)',
                                    borderRadius: '0.5rem'
                                }}>
                                    <span style={{ fontSize: '1.5rem', marginRight: '0.75rem' }}>
                                        {strategy.icon}
                                    </span>
                                    <div>
                                        <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>
                                            {strategy.title}
                                        </div>
                                        <div style={{ fontSize: '0.875rem', color: 'var(--gray-600)' }}>
                                            {strategy.description}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div className="card">
                            <h3 style={{ marginBottom: '1rem', color: 'var(--gray-800)' }}>
                                Achievements
                            </h3>
                            
                            {achievements.map((achievement, index) => (
                                <div 
                                    key={index}
                                    className={achievement.earned ? 'achievement-card' : ''}
                                    style={!achievement.earned ? {
                                        padding: '1rem',
                                        background: 'var(--gray-100)',
                                        borderRadius: '0.75rem',
                                        marginBottom: '0.75rem',
                                        opacity: 0.6,
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '1rem'
                                    } : {}}
                                >
                                    <div className="achievement-icon">
                                        {achievement.icon}
                                    </div>
                                    <div className="achievement-content">
                                        <h4>{achievement.title}</h4>
                                        <p>{achievement.description}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </>
                );
            };
            
            const CrisisModal = () => {
                const [breathPhase, setBreathPhase] = useState('ready');
                const [breathCount, setBreathCount] = useState(0);
                
                const startBreathing = () => {
                    setBreathPhase('inhale');
                    setBreathCount(1);
                    
                    const phases = [
                        { phase: 'inhale', duration: 4000, text: 'Einatmen...' },
                        { phase: 'hold', duration: 7000, text: 'Halten...' },
                        { phase: 'exhale', duration: 8000, text: 'Ausatmen...' }
                    ];
                    
                    let totalDuration = 0;
                    phases.forEach((p, index) => {
                        setTimeout(() => {
                            setBreathPhase(p.phase);
                        }, totalDuration);
                        totalDuration += p.duration;
                    });
                    
                    setTimeout(() => {
                        if (breathCount < 3) {
                            setBreathCount(prev => prev + 1);
                            startBreathing();
                        } else {
                            setBreathPhase('complete');
                        }
                    }, totalDuration);
                };
                
                const getBreathText = () => {
                    switch(breathPhase) {
                        case 'ready': return 'Bereit? Lass uns gemeinsam atmen.';
                        case 'inhale': return '4 Sekunden einatmen...';
                        case 'hold': return '7 Sekunden halten...';
                        case 'exhale': return '8 Sekunden ausatmen...';
                        case 'complete': return 'Gut gemacht! Das Verlangen wird nachlassen.';
                        default: return '';
                    }
                };
                
                return (
                    <div className="modal">
                        <div className="modal-content">
                            <div className="modal-header">
                                <h3>Akut-Intervention</h3>
                            </div>
                            
                            <div className="breathing-exercise">
                                <div className="breath-circle"></div>
                                <p className="breath-text">{getBreathText()}</p>
                                {breathPhase === 'ready' && (
                                    <button className="btn" onClick={startBreathing} style={{ marginTop: '1rem' }}>
                                        Atemübung starten
                                    </button>
                                )}
                                {breathPhase === 'complete' && (
                                    <button className="btn btn-secondary" onClick={() => setShowCrisisModal(false)} style={{ marginTop: '1rem' }}>
                                        Schließen
                                    </button>
                                )}
                            </div>
                            
                            <div style={{ marginTop: '1.5rem' }}>
                                <h4 style={{ marginBottom: '0.75rem' }}>Sofort-Strategien:</h4>
                                <ul style={{ paddingLeft: '1.5rem', lineHeight: '1.8' }}>
                                    <li>Verlangen dauert nur 3-5 Minuten</li>
                                    <li>Trinke sofort ein großes Glas kaltes Wasser</li>
                                    <li>Verlasse den Raum / ändere die Situation</li>
                                    <li>Schreibe deinem Partner eine Nachricht</li>
                                    <li>Mache 20 Kniebeugen oder Liegestütze</li>
                                </ul>
                            </div>
                            
                            {breathPhase !== 'inhale' && breathPhase !== 'hold' && breathPhase !== 'exhale' && (
                                <button 
                                    className="btn btn-secondary" 
                                    onClick={() => setShowCrisisModal(false)}
                                    style={{ marginTop: '1rem' }}
                                >
                                    Schließen
                                </button>
                            )}
                        </div>
                    </div>
                );
            };
            
            return (
                <div className="container">
                    <div className="header">
                        <h1>RauchFrei Duo</h1>
                        <p style={{ color: 'var(--gray-600)', marginBottom: '1rem' }}>
                            Gemeinsam zum Ziel - Tag {Math.floor((new Date() - new Date(userData.A.startDate)) / (1000 * 60 * 60 * 24)) + 1}
                        </p>
                        
                        <div className="user-selector">
                            <button 
                                className={`user-btn ${currentUser === 'A' ? 'active' : ''}`}
                                onClick={() => setCurrentUser('A')}
                            >
                                {userData.A.name}
                            </button>
                            <button 
                                className={`user-btn ${currentUser === 'B' ? 'active' : ''}`}
                                onClick={() => setCurrentUser('B')}
                            >
                                {userData.B.name}
                            </button>
                        </div>
                    </div>
                    
                    <div className="tab-navigation">
                        <button 
                            className={`tab-btn ${activeTab === 'today' ? 'active' : ''}`}
                            onClick={() => setActiveTab('today')}
                        >
                            Heute
                        </button>
                        <button 
                            className={`tab-btn ${activeTab === 'withdrawal' ? 'active' : ''}`}
                            onClick={() => setActiveTab('withdrawal')}
                        >
                            Entzug
                        </button>
                        <button 
                            className={`tab-btn ${activeTab === 'progress' ? 'active' : ''}`}
                            onClick={() => setActiveTab('progress')}
                        >
                            Fortschritt
                        </button>
                        <button 
                            className={`tab-btn ${activeTab === 'strategies' ? 'active' : ''}`}
                            onClick={() => setActiveTab('strategies')}
                        >
                            Strategien
                        </button>
                    </div>
                    
                    {activeTab === 'today' && renderTodayTab()}
                    {activeTab === 'withdrawal' && renderWithdrawalTab()}
                    {activeTab === 'progress' && renderProgressTab()}
                    {activeTab === 'strategies' && renderStrategiesTab()}
                    
                    <button 
                        className="crisis-btn"
                        onClick={() => setShowCrisisModal(true)}
                        title="Akutes Verlangen - Soforthilfe"
                    >
                        🆘
                    </button>
                    
                    {showCrisisModal && <CrisisModal />}
                </div>
            );
        };
        
        // Render the app
        ReactDOM.render(<SmokingCessationApp />, document.getElementById('app'));
    </script>
</body>
</html>